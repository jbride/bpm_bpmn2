:data-uri:
:toc2:
:startprocesseventlistener: link:https://github.com/droolsjbpm/jbpm/blob/master/jbpm-flow/src/main/java/org/jbpm/process/instance/ProcessRuntimeImpl.java#L347[StartProcessEventListener class]
:jbpmrelease: link:https://repository.jboss.org/nexus/content/groups/public-jboss/org/jbpm/jbpm-distribution/6.1.0.Final/jbpm-distribution-6.1.0.Final-installer.zip[community jbpm 6.1.0.Final release]
:jbpminstaller: link:http://docs.jboss.org/jbpm/v6.1.0.CR1/userguide/jBPMInstaller.html[jbpm v6.1.0.Final installer]

image::images/rhheader.png[width=900]

== Start Via Events

=== Overview

.sendEvent
image::images/parentSendEvent.png[]

image::images/blank.png[height=100]

.receiveStartEvents
image::images/startViaEvent.png[]

The purpose of this example is to deep-dive into various types of BPMN2 _process start events_ and their implementation in BPM Suite 6.
This example includes the two process diagrams depicted above.

==== BPMN2 specification
The following is relevant material found in the BPMN2 specification (specifically, Section *10.4.2 Start Event* / Table *10.84*)  regarding _Start Events_:

. *Message* Start Event
A Message arrives from a Participant and triggers the start of the Process
See page 93 for more details on Messages.
If there is only one EventDefinition associated with the Start Event and that EventDefinition is of the subclass MessageEventDefinition, then the Event is a Message Start Event and MUST be displayed with an envelope marker (see the figure to the right).
The actual Participant from which the Message is received can be identified by connecting the Event to a Participant using a Message Flow within the definitional Collaboration of the Process â€“ see Table 10.1.


. *Signal* Start Event
A Signal arrives that has been broadcast from another Process and triggers the start of the Process.
Note that the Signal is not a Message, which has a specific target for the Message.
Multiple Processes can have Start Events that are triggered from the same broadcasted Signal.
If there is only one EventDefinition associated with the Start Event and that EventDefinition is of the subclass SignalEventDefinition,then the Event is a Signal Start Event and MUST be displayed with a triangle marker (see the figure to the right).

=== Pre-Requisites

. ssh client
. maven 3.0.5 (or greater)
. git client
. curl
. familiarity with {bpmproduct}
. proficiency with basic *nix command line
. local installation of {jbpmrelease}
+
NOTE:  start events do not work in supported BPM Suite 6.
The fix is found only in the upstream community jbpm v6.0.1.Final.
Under certain circumstances, there are bugs with start event nodes even in community jbpm v6.0.1.Final.
Those issues are discussed later in this reference architecture documentation.

=== Set-up

==== Local install of community jbpm v6.0.1.Final
Follow the instructions for the {jbpminstaller}

=== Test

==== community jbpm6.1.0.Final
Need to use 'event' keyword when signalling as per {startprocesseventlistener}.

https://community.jboss.org/message/884049#884049

==== BPM Suite 6.0.2
-----
curl -vv -u jboss:brms -X POST http://docker_bpms:8080/business-central/rest/runtime/com.redhat.gpe.refarch.bpm_signalling:processTier:1.0/signal?signal=startViaSignalA?event=234
-----

-----
Caused by: org.jbpm.workflow.instance.WorkflowRuntimeException: [Minimal:4 - EndProcess:3] -- Unknown node instance type: org.jbpm.workflow.instance.node.ActionNodeInstance@4cd7554d
    at org.jbpm.workflow.instance.impl.NodeInstanceImpl.trigger(NodeInstanceImpl.java:161) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.impl.NodeInstanceImpl.triggerNodeInstance(NodeInstanceImpl.java:337) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.impl.NodeInstanceImpl.triggerCompleted(NodeInstanceImpl.java:296) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.node.ActionNodeInstance.triggerCompleted(ActionNodeInstance.java:61) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.node.ActionNodeInstance.internalTrigger(ActionNodeInstance.java:57) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.impl.NodeInstanceImpl.trigger(NodeInstanceImpl.java:155) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.impl.NodeInstanceImpl.triggerNodeInstance(NodeInstanceImpl.java:337) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.impl.NodeInstanceImpl.triggerCompleted(NodeInstanceImpl.java:296) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.node.StartNodeInstance.triggerCompleted(StartNodeInstance.java:66) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.node.StartNodeInstance.internalTrigger(StartNodeInstance.java:43) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.impl.NodeInstanceImpl.trigger(NodeInstanceImpl.java:155) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.ruleflow.instance.RuleFlowProcessInstance.internalStart(RuleFlowProcessInstance.java:35) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.process.instance.impl.ProcessInstanceImpl.start(ProcessInstanceImpl.java:226) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.workflow.instance.impl.WorkflowProcessInstanceImpl.start(WorkflowProcessInstanceImpl.java:362) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.process.instance.ProcessRuntimeImpl.startProcessInstance(ProcessRuntimeImpl.java:194) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.process.instance.ProcessRuntimeImpl.startProcess(ProcessRuntimeImpl.java:176) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.process.instance.ProcessRuntimeImpl$StartProcessEventListener.signalEvent(ProcessRuntimeImpl.java:393) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.process.instance.event.DefaultSignalManager.internalSignalEvent(DefaultSignalManager.java:81) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.jbpm.process.instance.event.DefaultSignalManager$SignalAction.execute(DefaultSignalManager.java:181) [jbpm-flow-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    at org.drools.core.common.AbstractWorkingMemory.executeQueuedActions(AbstractWorkingMemory.java:1239) [drools-core-6.0.3-redhat-4.jar:6.0.3-redhat-4]
    ... 91 more
Caused by: java.lang.IllegalArgumentException: Unknown node instance type: org.jbpm.workflow.instance.node.ActionNodeInstance@4cd7554d

-----
